---

copyright:
  years: 2016, 2018
lastupdated: "2018-01-17"

---

{:new_window: target="\_blank"}
{:shortdesc: .shortdesc}
{:screen: .screen}
{:codeblock: .codeblock}
{:pre: .pre}
{:tip: .tip}

# 概説のチュートリアル
{: #getting-started-with-iotp}

この {{site.data.keyword.iot_full}} の概説のチュートリアルでは、IoT デバイスを {{site.data.keyword.iot_short_notm}} に接続し、分析をセットアップして、リアルタイム・データを探索します。
{:shortdesc}

<div id="prerequisites"></div>

## 始めに
{: #prereqs}

[IBM Cloud アカウント ![外部リンク・アイコン ](../../icons/launch-glyph.svg "外部リンク・アイコン")](https://console.bluemix.net/registration/){: new_window}、{{site.data.keyword.iot_short_notm}} サービスのインスタンス、以下の要件を満たすデバイスが必要になります。

*	デバイスは、HTTP プロトコルまたは MQTT プロトコルを使用して通信できるようでなければなりません。

* デバイス・メッセージは、{{site.data.keyword.iot_short_notm}} のメッセージ・ペイロードの要件に準拠していなければなりません。

詳細については、[Watson IoT Platform でのデバイスの開発](/docs/services/IoT/devices/device_dev_index.html)を参照してください。

## 手順 1: デバイスの登録

[{{site.data.keyword.iot_short_notm}} ダッシュボード ![外部リンク・アイコン](../../icons/launch-glyph.svg "外部リンク・アイコン")](https://internetofthings.ibmcloud.com){: new_window} から一度に 1 つずつデバイスを追加するか、[Watson IoT プラットフォーム API ![外部リンク・アイコン](../../icons/launch-glyph.svg "外部リンク・アイコン")](https://docs.internetofthings.ibmcloud.com/apis/swagger/v0002/org-admin.html#!/Device_Bulk_Configuration/post_bulk_devices_add){: new_window} を使用して複数のデバイスを追加することができます。

{{site.data.keyword.iot_short_notm}} ダッシュボードからデバイスを追加するには、以下のようにします。

1. {{site.data.keyword.Bluemix_notm}} コンソールで、{{site.data.keyword.iot_short_notm}} サービスの詳細ページの**「起動」**をクリックします。

    新しいブラウザー・タブで以下の URL の {{site.data.keyword.iot_short_notm}} Web コンソールが開きます。

    ```
    https://org_id.internetofthings.ibmcloud.com/dashboard/#/overview
    ```

    ここで、*org_id* は [{{site.data.keyword.iot_short_notm}} 組織](iotplatform_overview.html#organizations){: new_window}の ID です。

2. 「概要」ダッシュボードのメニュー・ペインから**「デバイス」**を選択し、**「デバイスの追加」**をクリックします。

3. 追加するデバイスのデバイス・タイプを作成します。

    {{site.data.keyword.iot_short_notm}} に接続する各デバイスには、デバイス・タイプを関連付ける必要があります。 デバイス・タイプとは、共通の特性を共有するデバイス・グループのことです。

    1. **「デバイス・タイプの作成」**をクリックします。
    2. `my_device_type` などのデバイス名と、デバイス・タイプの説明を入力します。
    
        > **注意:** デバイス・タイプ名は 36 文字以内にする必要があり、英数字の文字 (a-z, A-Z, 0-9) と、`_`、`.`、および `-`のいずれかのみを含めることができます。

    3. オプション: デバイス・タイプの属性やメタデータを入力します。

        属性とメタデータは、後で追加および編集できます。
        {: tip}

4. **「次へ」**をクリックして、選択したデバイス・タイプのデバイスを追加するプロセスを開始します。

5. `my_first_device` などのデバイス ID を入力します。

    デバイス ID は、{{site.data.keyword.iot_short_notm}} ダッシュボードでデバイスを識別するために使用され、デバイスを {{site.data.keyword.iot_short_notm}} に接続するための必須パラメーターでもあります。

    > **注意:** デバイス・タイプ名は 36 文字以内にする必要があり、英数字の文字 (a-z, A-Z, 0-9) と、`_`、`.`、および `-`のいずれかのみを含めることができます。

    ネットワークに接続されたデバイスの場合は、デバイス MAC アドレス (区切り文字のコロンは付けない) をデバイス ID として入力できます。

5. **「次へ」**をクリックすると、プロセスが完了します。

6. 認証トークンを指定するか、自動生成されたトークンを受け入れます。 自分でトークンを作成する場合は、長さを 8 文字から 36 文字の間にして、英数字と、`_`、`.`、`!`、`&`、`@`、`?`、`\*`、`+`、`(`、`)`、`-` だけを使用してください。

    反復した文字シーケンスや、辞書に出てくる単語やユーザー名などの事前定義シーケンスをトークンに含めないでください。

7. 要約情報が正しいことを確認してから、**「追加」**をクリックして接続を追加します。

8. デバイス情報のページで、以下の詳細をコピーして保存します。

    * 組織 ID
    * デバイス・タイプ
    * デバイス ID
    * 認証方式
    * 認証トークン

    {{site.data.keyword.iot_short_notm}} へのデバイスの接続を構成するときに、組織 ID、デバイス・タイプ、デバイス ID、および認証トークンが必要になります。

## 手順 2: {{site.data.keyword.iot_short_notm}} とデバイスの接続

1. MQTT メッセージングを使用するようにデバイスをセットアップし、組織 ID、デバイス・タイプ、デバイス ID、および認証トークンを使用して認証します。

2. MQTT プロトコルを使用して、デバイス・メッセージを {{site.data.keyword.iot_short_notm}} 組織に送信します。

    デバイスを接続するときには、以下の情報が必要になります。

    * URL: *org_id*.messaging.internetofthings.ibmcloud.com

      *org_id* は、{{site.data.keyword.iot_short_notm}} 組織の ID です。

    * ポート:
      * 1883
      * 8883 (暗号化)
      * 443 (Web ソケット)
    * デバイス ID: d:_org_id:device_type:device_id_
    * ユーザー名: use-token-auth
    * パスワード: _Authentication token_
    * イベント・トピック形式: iot-2/evt/_event_id/fmt/format_string_

      _event_id_ では、{{site.data.keyword.iot_short_notm}} に表示されるイベント名を指定します。_format_string_ は、イベントの形式 (JSON など) です。

    * メッセージ形式: JSON

  詳しくは、[デバイスの MQTT 接続](/docs/services/IoT/devices/mqtt.html)を参照してください。

## 手順 3: デバイス・データを追跡するためのボードとカードの作成

ボードとカードを使用すると、1 つ以上のデバイスから取得されたデータ・セットの値を示すグラフィックスを表示し、デバイス・データの概要を簡単に把握できます。

1. {{site.data.keyword.iot_short_notm}} ダッシュボードで、**「新規ボードの作成」**をクリックします。

2. ボードの名前と説明を入力します。

3. **「次へ」**、**「作成」**の順にクリックします。

4. 作成したばかりのボードをクリックし、**「新しいカードの追加」**をクリックします。 カード・タイプとして「デバイス」を選択します。 次の表は、選択できる視覚化オプションについての説明を示しています。

| タイプ | 表示されるデータ |
|---------------|---------------|
| 汎用視覚化 | 1 つ以上のデータ・セットの値。 大きいウィジェット・サイズを選択すると、最大 3 つのデータ・ポイント値が小さなテーブルに表示されます。 |
| 折れ線グラフ | リアルタイム・スクロール・グラフの 1 つ以上のデータ・セット。 「設定」メニューを使用して、データ範囲、保存、グラフの外観などを設定します。 |
| 棒グラフ | ラベル付きバーのデータ・セット値。 水平または垂直バーの方向を切り替えるには「設定」メニューを使用します。 |
| ドーナツ・グラフ | 円形表記の 2 つ以上のデータ・セット。 |
| 値 | 1 つ以上のデータ・セットの未加工値。 |
| ゲージ | ゲージで表示されるデータ・セットの値。 オプションで低、中、上のデータ範囲にゲージしきい値を設定するには、「設定」メニューを使用します。 |
| デバイス・プロパティー | 1 つ以上のデバイスの特定のプロパティー。 |
| すべてのデバイス・プロパティー | 1 つ以上のデバイスのすべてのプロパティー。 |
| デバイス・リスト | 複数のデバイスをモニターするためのリスト。 リストは、他のカードのデータ・ソースとして使用することができます。 |
| デバイス情報 | 単一デバイスの基本情報。 |
| デバイス・マップ | デバイス・リスト内のデバイスの場所。 |

{: caption="表 1. 視覚化のオプション" caption-side="top"}

## 手順 4: デバイス・タイプ・スキーマの作成

マップされたデバイス・プロパティーのデータポイントに基づいてトリガーされるルールを後で作成するために、この時点で、デバイス・タイプ・スキーマを作成し、デバイスのプロパティーをマップする必要があります。

1. {{site.data.keyword.iot_short_notm}} ダッシュボードで、**「デバイス」>「スキーマの管理」**に移動し、**「スキーマの追加」**をクリックします。

2. メッセージ・スキーマに関連付けるデバイス・タイプを選択します。 1 つのデバイス・タイプには 1 つのスキーマのみを定義できます。

3. **「プロパティーの追加」**をクリックし、1 つ以上のプロパティーを追加します。

    接続先のデバイスからプロパティーを選択することも、既存のプロパティーを変更したり組み合わせたりする仮想プロパティーを作成することも、プロパティーを手動で追加することもできます。

    使用可能なプロパティーは、デバイスによって送信されたメッセージのペイロードに定義されています。
    {: tip}

    * プロパティーを手動で追加する場合は、**「手動」タブ**を選択し、以下のプロパティーの詳細を定義します。
        * 名前
        * データ・タイプ
        * プロパティー
        * データの単位 (オプション)
        * 小数点以下の桁数 (オプション)

    * 仮想プロパティーを作成する場合は、**「仮想プロパティー」**タブを選択し、以下のプロパティーの詳細を定義します。
        * 名前
        * データ・タイプ
        * プロパティー
        * 計算
        * データの単位 (オプション)
        * 小数点以下の桁数

    * 接続されたデバイスからプロパティーを選択する場合は、**「接続先から」**タブを選択し、スキーマに追加する 1 つ以上のプロパティーを選択します。 選択したプロパティーが追加され、説明がプロパティーの名前に設定されます。

4. **「完了」**をクリックすると、プロパティーが作成されます。

## 手順 5: ルールとアクションの作成

ルールは、リアルタイム・デバイス・データを事前定義しきい値または他のプロパティー・データと突き合わせる条件に基づく決定点です。条件が満たされた場合に、アラートがトリガーされます。 {{site.data.keyword.iot_short_notm}} ダッシュボードに表示されるアラートに加えて、ルールがトリガーされた場合にビジネス・ロジックを実行する 1 つ以上のアクションを追加できます。

1. {{site.data.keyword.iot_short_notm}} ダッシュボードで、**「ルール」**に移動し、**「クラウド規則の作成」**をクリックします。

2. ルールの名前と説明を入力し、ルールが適用されるデバイス・タイプを選択した後、**「次へ」**をクリックします。

3. ルール・ロジックを設定するために、ルールのトリガーとして使用する 1 つ以上の IF 条件を追加します。

    並列行に条件を追加して OR 条件として適用したり、順次列に条件を追加して AND 条件として適用したりすることもできます。 以下の例を見てください。

      * 単純ルールにより、パラメーター値が指定された値を超えると、アラートがトリガーされます。条件 = `temp_cpu>80`
      * より複雑なルールにより、しきい値の組み合わせが満たされた場合にトリガーされます。条件 = `temp_cpu>60 AND cpu_load>90`

    2 つのプロパティーを比較する条件をトリガーするか、AND を使用して順次結合される 2 つ以上のプロパティー条件をトリガーするには、トリガー元のデータ・ポイントを同じデバイス・メッセージに含めます。 データが複数のメッセージで受信された場合、そのような条件または順次条件はトリガーされません。
    {: tip}

4. ルールに対して条件付きトリガー要件を構成します。

    一定期間にわたってあるルールでトリガーされるアラートの数を制御するために、条件付きトリガー要件を使用できます。 条件付きトリガーは、ルール内のすべての条件に対して機能します。 例えば、1 つのルールに OR を使用して設定された 5 つの並列条件が含まれる場合、満たされる各条件は条件付きトリガー・カウントに加算されます。

      1. ルール・エディターで、デフォルトの**「条件が満たされるたびにトリガーする (Trigger each time conditions are met)」**リンクをクリックし、「頻度要件の設定」ダイアログを開きます。
      2. ルールで使用する条件付きトリガーを選択して構成します。

        * 条件が満たされるたびにトリガーします。
        * 条件が M _時間単位_内に N 回満たされたらトリガーします。

5. ルールの条件が満たされた場合に発生する 1 つ以上のアクションを作成または選択します。

    例として、E メールの送信や、Webhook への通知といったアクションが考えられます。

6. オプション: ルールのアラート優先順位を選択します。

    優先順位は、**「ボード」>「ルール・ベースの分析 (Rule-Based Analytics)」**ボードに表示されるアラートを分類するために使用されます。 デフォルトの優先順位は「低 (Low)」です。

7. アクティブ化せずに保存するには**「保存」**をクリックし、ルールを保存してアクティブにするには**「アクティブ化」**をクリックします。

    ルールをアクティブにした場合、ルールの条件が満たされると、アラートが**「ルール・ベースの分析 (Rule-Based Analytics)」**ボードに追加され、該当するルール・アクションが実行されます。

## 次の手順

リアルタイムと履歴のデバイス・データをコンシュームする独自のアプリを作成して接続することで、データ分析機能を拡張します。

  * デバイスとアプリを統合し、接続するためのコードをビルドする場合は、ツールの[クライアント・ライブラリー](/docs/services/IoT/iot_platform_client_lib.html)を参照してください。

  * 接続したデバイスとアプリにより高度な分析を埋め込む方法に関する詳細なチュートリアルについては、[Watson IoT プラットフォームのレシピ![外部リンク・アイコン](../../icons/launch-glyph.svg "外部リンク・アイコン")](https://developer.ibm.com/recipes/tutorials/category/internet-of-things-iot/){: new_window}を参照してください。
