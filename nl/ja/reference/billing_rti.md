---
copyright:
  years: 2016, 2018
lastupdated: "2018-01-11"
---
{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:screen: .screen}
{:codeblock: .codeblock}
{:pre: .pre}

# 課金

有料の {{site.data.keyword.iot_full}} サービス・プラン (Lite 以外のプラン) は、1 カ月あたりのデータ交換とデータ分析の量 (メガバイト) に基づく課金になっています。  この資料では、{{site.data.keyword.iot_short_notm}} のデータ課金について詳しく説明します。使用量の情報を作成し、その情報に基づいて使用料金を決定するシステムです。  使用量の情報を確認すれば、デバイスやアプリケーションやゲートウェイの設計や数に基づいて {{site.data.keyword.iot_short_notm}} の使用料金を概算できます。

データ交換とデータ分析の 1 メガバイトあたりの料金については、必要な地域の {{site.data.keyword.Bluemix_notm}} カタログにある {{site.data.keyword.iot_short_notm}} サービスの情報を確認してください。

[Pricing Calculator ![外部リンク・アイコン](../../../icons/launch-glyph.svg "外部リンク・アイコン")](http://iot-cost-calculator.ng.bluemix.net/) を使用すれば、{{site.data.keyword.iot_short_notm}} サービスの料金を計算できます。

以下の 3 つの項目ごとに使用量が計算され、それぞれの情報に基づいて課金されます。 
- データ交換
- データ分析
- エッジ・データ分析

## データ交換
*データ交換*の計算には、MQTT メッセージや HTTP メッセージでアプリケーション/デバイス/ゲートウェイ間で交換されたアカウント・データと、HTTP API によってアプリケーション間で交換されたデータが組み込まれます。

### MQTT データ交換
MQTT を使用する場合は、TCP ストリームのコンテンツが*データ交換*としてカウントされます。  あらゆる MQTT メッセージのペイロードが、MQTT プロトコルによるデータ交換の累計に組み込まれます。  ペイロードのデータ・サイズが累積されるのは、メッセージがパブリッシュされた時とメッセージがサブスクライバーに送信された時の両方です。

MQTT プロトコルは、非常に軽量な設計になっています。  {{site.data.keyword.iot_short_notm}} では、*データ交換*の累積量に MQTT パケットのサイズが組み込まれますが、プロトコル自体が軽量なので、オーバーヘッドは小さくなります。  各 MQTT パケットの最小サイズの目安を以下の表にまとめます。

|MQTT パケット                    |最小サイズ (バイト)  |変数に関連する最小サイズ (バイト)|
|-------------------------------|--------------------|-------------------------------------------------|
|CONNECT                        |56                  |クライアント ID (d:xxxxxx:t:i の場合は 12)。will トピック (0) と will メッセージ (0) (設定した場合)。ユーザー名 (デバイスの場合は 14 - 'use-token-auth')。パスワード (自動生成の場合は 18)。|
|CONNACK                        |4                   |なし|
|PUBLISH                        |21                  |トピック名 (iot-2/evt/i/fmt/f の場合は 17)。ペイロード (最小は 0)。  適用対象はインバウンドとアウトバウンドの両方の PUBLISH パケット。|
|PUBACK                         |4                   |なし|
|PUBREC                         |4                   |なし|
|PUBREL                         |4                   |なし|
|PUBCOMP                        |4                   |なし|
|SUBSCRIBE                      |26                  |トピック・フィルター (iot-2/evt/i/fmt/f の場合は 19) と QoS (1) の乗算値が組み込まれる場合もある。|
|SUBACK                         |5                   |SUBSCRIBE のトピック・フィルターごとに (1)|
|UNSUBSCRIBE                    |23                  |複数のトピック・フィルター (iot-2/evt/i/fmt/f の場合は 19) が組み込まれる場合もある。|
|UNSUBACK                       |4                   |なし|
|PINGREQ                        |2                   |なし|
|PINGRESP                       |2                   |なし|
|DISCONNECT                     |2                   |なし|

TLS を使用する場合は、セキュア・ハンドシェークも対象になります。 ハンドシェークは約 8 キロバイトです。 したがって、MQTT 接続をできる限り長く開いておくほうが、費用対効果が高くなります。 接続を開いておく場合は、1 回のキープアライブ間隔で PINGREQ と PINGRESP のオーバーヘッド (4 バイト) しか発生しません。キープアライブ間隔はキープアライブ期間によって決まり、クライアントごとに異なります。  既存の TLS セッションを使用して TLS 接続を再び開くと、交換バイト数が減ります。どちらの方向にも証明書が送信されないからです。  多くの TLS クライアントは、デフォルトでこの動作に対応していますが、セッションの存続期間に制限があります。  クライアント証明書を使用すると、クライアント証明書のサイズに応じて TLS ハンドシェークのサイズが大きくなります。 

TLS レコード、TCP オーバーヘッド、IP オーバーヘッドは、対象になりません。

**注** - {{site.data.keyword.iot_short_notm}} ダッシュボードを使用してデバイスを表示すると、MQTT サブスクリプションによって、ダッシュボードでライブ・イベントを表示できるようになります。  この MQTT サブスクリプションも、データ交換としてカウントされ、合計量に加算されます。

### HTTP メッセージ・データ交換
HTTP メッセージを使用する場合に、メッセージ・ペイロードが*データ交換*の累積に組み込まれるのは、イベントのパブリッシュ時とコマンドの受信時の両方です。

MQTT の場合と同じく、HTTP のオーバーヘッドもカウントされます。  HTTP のオーバーヘッドは、MQTT のオーバーヘッドよりかなり大きくなります。 要求 1 つあたりの HTTP のオーバーヘッドは約 300 バイトです。 メッセージ・ペイロード・サイズも加算する必要があります。

TLS を使用する場合は、セキュア・ハンドシェークが対象になります。  ハンドシェークは約 8 キロバイトです。  したがって、HTTPS 接続をできる限り長く開いておくほうが、費用対効果が高くなります。  接続を開いておいても、*データ交換*としての追加のオーバーヘッドは発生しません。  既存の TLS セッションを使用して TLS 接続を再び開くと、交換バイト数が減ります。どちらの方向にも証明書が送信されないからです。  多くの TLS クライアントは、デフォルトでこの動作に対応していますが、セッションの存続期間に制限があります。  クライアント証明書を使用すると、クライアント証明書のサイズに応じて TLS ハンドシェークのサイズが大きくなります。

TLS レコード、TCP オーバーヘッド、IP オーバーヘッドは、対象になりません。

### HTTP API データ交換
アプリケーションから API を呼び出すと、要求と応答の両方の本体が*データ交換*の累積に加算されます。  それぞれのサイズは、API によってかなり異なります。

MQTT メッセージや HTTP メッセージの場合とは異なり、HTTP API データ交換では、HTTP のオーバーヘッドも TLS のオーバーヘッドも対象になりません。

**注** - {{site.data.keyword.iot_short_notm}} ダッシュボードの使用時には、ダッシュボードで HTTP API が使用され、デバイス、デバイス・タイプ、デバイス接続ログなどの情報がリストに表示されます。  そのような HTTP API 呼び出しも *データ交換*としてカウントされます。

## データ分析
*データ分析*の計算では、プラットフォーム内のルール・エンジンによって処理されたイベント・データの量が測定されます。  データがルール・エンジンによって処理されたと見なされるのは、デバイス・イベントがデバイス・タイプやイベント・タイプに基づいて 1 つ以上のルールによって評価された時です。 

## エッジ・データ分析
*エッジ・データ分析*の計算では、ゲートウェイ・デバイスで {{site.data.keyword.iot_short_notm}} のエッジ分析エージェントによって処理されたイベント・データの量が測定されます。  データがエッジ・エージェントによって処理されたと見なされるのは、デバイス・イベントがデバイス・タイプやイベント・タイプに基づいて 1 つ以上のエッジ・ルールによって評価された時です。 
